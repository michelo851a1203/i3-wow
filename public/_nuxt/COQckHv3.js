import{o as O,s as h,n as j,e as te,l as ne,u as re}from"./BeNRzrwp.js";import{b,p as se}from"./BMigu0w3.js";import{T as D,l as B,G as oe,p as ae,q as N}from"./CYd5hogt.js";const we=O({email:h().email("請輸入 email 格式").min(1,"請輸入 email").max(50,"你的 email 太長了吧！"),password:h().min(6,"長度為6-18個字元").max(18,"長度為6-18個字元").regex(/(?=.*[A-Z]).*/g,"包含1個大寫字母").regex(/(?=.*\d).*/g,"包含1個數字")}),E=O({iss:h(),sub:h(),iat:j().int().nonnegative("請輸入正整數或0"),exp:j().int().nonnegative("請輸入正整數或0"),nbf:j().int().nonnegative("請輸入正整數或0"),jti:h(),userName:h().min(1,"必須要有姓名"),role:h()}),ie=D("useStorageStore",()=>({dbName:"image",name:"i3-big-data-pets-image",version:1}),n=>{const X=()=>(window.indexedDB||console.warn("Your browser does not support the IndexedDB API"),!!window.indexedDB),k=c=>c instanceof IDBOpenDBRequest,g=async()=>X()?new Promise((c,a)=>{const i=window.indexedDB.open(n.name,n.version);i.onerror=()=>a(i.error),i.onsuccess=()=>c(i.result),i.onupgradeneeded=f=>{const d=f.target;if(!k(d))return;const w=d.result;if(w.objectStoreNames.contains(n.name))return;const u=w.createObjectStore(n.name,{keyPath:"id",autoIncrement:!0});u.createIndex("name","name",{unique:!1}),u.createIndex("timeStamp","timeStamp",{unique:!1})}}):null,r=(c,a)=>(i,f)=>new Promise((d,w)=>{const p=c.transaction(a,"readwrite").objectStore(a),P={name:i,data:f,timeStamp:Date.now()},l=p.add(P);l.onsuccess=()=>d(l.result),l.onerror=()=>w(l.error)}),y=(c,a)=>()=>new Promise((i,f)=>{const u=c.transaction(a,"readonly").objectStore(a).getAll();u.onsuccess=()=>i(u.result),u.onerror=()=>f(u.error)}),A=(c,a)=>i=>new Promise((f,d)=>{const p=c.transaction(a,"readwrite").objectStore(a).delete(i);p.onsuccess=()=>f(!0),p.onerror=()=>d(p.error)}),I=(c,a)=>i=>new Promise((f,d)=>{const P=c.transaction(a,"readonly").objectStore(a).index("name").getAll();P.onsuccess=()=>{const m=P.result.filter(U=>U.name===i);f(m)},P.onerror=()=>d(P.error)});return{storeName:B(()=>n.name),initializeImageIndexDB:g,saveImage:r,getAllImage:y,deleteImage:A,searchImageByName:I}}),ce=()=>{const n=g=>new Promise(r=>setTimeout(r,g));return{singin:async g=>(console.log(g),await n(500),"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJleGFtcGxlLWF1dGgtc2VydmljZSIsInN1YiI6InVzZXIxMjMiLCJpYXQiOjE2NTI3ODQ1NjAsImV4cCI6MTY1Mjc4NjM2MCwibmJmIjoxNjUyNzg0NTYwLCJqdGkiOiIxNjUyNzg0NTYwIiwidXNlck5hbWUiOiJKb2huIERvZSIsInJvbGUiOiJhZG1pbiJ9.XXXXXXXXXXXXXXXXXXXXXXXXXXXXX"),signOut:async()=>!0}},le=()=>{const n=r=>new Promise(y=>setTimeout(y,r));return{signUp:async r=>(console.group("%c test","color: yellow;"),console.log(r),console.groupEnd(),await n(800),!0),getEmailVerifyCode:async r=>(console.group("%c test","color: yellow;"),console.log(r),console.groupEnd(),await n(800),!0),petSitterSignUp:async r=>(console.group("%c test","color: yellow;"),console.log(r),console.groupEnd(),await n(800),!0)}},ue=()=>{const n=r=>new Promise(y=>setTimeout(y,r));return{forgetPassword:async r=>(console.log(r),await n(500),!0),getVerifyCode:async r=>(console.log(r),await n(500),!0),renewPassword:async r=>(console.log(r),await n(500),!0)}},ye=D("useAuthStore",()=>({isShowLoginAlert:!1,isShowSignUpAlert:!1,petSitterPersonalForm:null,fakeToken:null}),n=>{const X="petSitter_signup_personal_temp",k=ie(),{initializeImageIndexDB:g,saveImage:r,getAllImage:y,deleteImage:A}=k,{storeName:I}=oe(k),c=ae(),{singin:a,signOut:i}=ce(),{signUp:f,getEmailVerifyCode:d,petSitterSignUp:w}=le(),{forgetPassword:u,getVerifyCode:p,renewPassword:P}=ue(),{customTypeError:l,fatalError:m}=re(),U=async e=>{try{const t=await a(e);if(t===""||!H(t))return!1;const s=K(t);return s?(F(s),J(!0),!0):!1}catch(t){return l(t)||m(t),!1}},L=async e=>{try{const t=await f(e);return t&&x(!0),t}catch(t){return l(t)||m(t),!1}},C=async()=>{try{return await i()}catch(e){return l(e)||m(e),!1}},R=async e=>{try{return await u(e)}catch(t){return l(t)||m(t),!1}},q=async e=>{try{return await p(e)}catch(t){return l(t)||m(t),!1}},V=async e=>{try{return await d(e)}catch(t){return l(t)||m(t),!1}},G=async e=>{try{return await P(e)}catch(t){return l(t)||m(t),!1}},v=async e=>{const t=Object.fromEntries(Object.entries(e).filter(([o])=>!["identityImageFront","identityImageBack"].includes(o)));localStorage.setItem(X,JSON.stringify(t)),n.petSitterPersonalForm=e;const s=await g();return s===null||e.identityImageFront&&e.identityImageBack&&await Promise.all([r(s,I.value)(b.PersonalIdentityImageFront,e.identityImageFront),r(s,I.value)(b.PersonalIdentityImageBack,e.identityImageBack)]),!0},M=async e=>{if(n.petSitterPersonalForm===null)return N(c("signUp-petSitter")),!1;const{success:t}=se.safeParse(n.petSitterPersonalForm);if(!t)return N(c("signUp-petSitter")),!1;const s={...n.petSitterPersonalForm,...e};try{return await w(s)}catch(o){return l(o)||m(o),!1}},J=e=>{n.isShowLoginAlert=e},x=e=>{n.isShowSignUpAlert=e},z=async e=>{n.petSitterPersonalForm={...e,identityImageFront:null,identityImageBack:null};const t=await g();if(t===null)return;const s=await y(t,I.value)(),o=s.find(T=>T.name===b.PersonalIdentityImageFront);o&&(n.petSitterPersonalForm.identityImageFront=o.data);const S=s.find(T=>T.name===b.PersonalIdentityImageBack);S&&(n.petSitterPersonalForm.identityImageBack=S.data)},Y=()=>{n.petSitterPersonalForm=null},Z=async()=>{const e=await g();if(e===null)return!1;const t=await y(e,I.value)(),s=t.find(S=>S.name===b.PersonalIdentityImageFront);s&&s.id&&await A(e,I.value)(s.id);const o=t.find(S=>S.name===b.PersonalIdentityImageBack);return o&&o.id&&await A(e,I.value)(o.id),!0},F=e=>{n.fakeToken=e,localStorage.setItem("fakeToken",JSON.stringify(e))},H=e=>h().refine(s=>{const o=s.split(".");if(!(o.length===3))return!1;const Q=O({alg:te(["HS256","HS384","HS512","RS256","RS384","RS512","ES256","ES384","ES512","PS256","PS384","PS512","none"]),typ:ne("JWT")}),W=atob(o[0]),_=JSON.parse(W);if(!Q.safeParse(_).success)return!1;const $=atob(o[1]),ee=JSON.parse($);return!!E.safeParse(ee).success}).safeParse(e).success,K=e=>{const t=e.split(".");if(t.length!==3)return;const s=atob(t[1]),o=JSON.parse(s),S=E.safeParse(o);if(S.success)return S.data};return{isShowLoginAlert:B(()=>n.isShowLoginAlert),isShowSignUpAlert:B(()=>n.isShowSignUpAlert),fakeToken:B(()=>n.fakeToken),handleSignIn:U,handleSignUp:L,handleSignOut:C,handleForgetPassword:R,handleSendEmailToGetVerificationCode:V,handleForgetPasswordVerifyCode:q,handleRenewPassword:G,finishPetSitterSignUpPersonal:v,handlePetSitterSignUp:M,changeIsShowLoginAlert:J,changeIsShowSignUpAlert:x,setPetSitterPersonalForm:z,resetPetSitterPersonalForm:Y,removeImageDBPersonal:Z,setFakeToken:F}});export{ie as a,E as j,we as s,ye as u};
