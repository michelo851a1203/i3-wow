import{_ as b,d as w,S as g,J as E,K as _,V as S,aq as m,au as j,o as O,c as $,v as A,j as J,k as F,y as k}from"./CYd5hogt.js";import{e as P}from"./DvBWbfjg.js";class d extends Error{constructor(e){super(e),this.message=e,Object.setPrototypeOf(this,d.prototype)}}const Y=w({props:{schema:{type:[Object,Function],default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(r,{expose:e,emit:t}){const u=g(),s=P(`form-${u}`);E(()=>{s.on(async a=>{var o;a.type!=="submit"&&((o=r.validateOn)!=null&&o.includes(a.type))&&await p(a.path,{silent:!0})})}),_(()=>{s.reset()});const n=S([]);m("form-errors",n),m("form-events",s);const l=S({});m("form-inputs",l);async function y(){let a=await r.validate(r.state);if(r.schema){const{errors:o,result:i}=await x(r.state,r.schema);o?a=a.concat(o):Object.assign(r.state,i)}return a}async function p(a,o={silent:!1}){let i=a;if(a&&!Array.isArray(a)&&(i=[a]),i){const f=n.value.filter(c=>!i.includes(c.path)),v=(await y()).filter(c=>i.includes(c.path));n.value=f.concat(v)}else n.value=await y();if(n.value.length>0){if(o.silent)return!1;throw new d(`Form validation failed: ${JSON.stringify(n.value,null,2)}`)}return r.state}async function h(a){var i;const o=a;try{(i=r.validateOn)!=null&&i.includes("submit")&&await p(),o.data=r.state,t("submit",o)}catch(f){if(!(f instanceof d))throw f;const v={...o,errors:n.value.map(c=>({...c,id:l.value[c.path]}))};t("error",v)}}return e({validate:p,errors:n,setErrors(a,o){o?n.value=n.value.filter(i=>i.path!==o).concat(a):n.value=a},async submit(){await h(new Event("submit"))},getErrors(a){return a?n.value.filter(o=>o.path===a):n.value},clear(a){a?n.value=n.value.filter(o=>o.path!==a):n.value=[]}}),{onSubmit:h,errors:j(n)}}});function B(r){return r.validate&&r.__isYupSchema__}function V(r){return r.inner!==void 0}function q(r){return"schema"in r&&typeof r.coercer=="function"&&typeof r.validator=="function"&&typeof r.refiner=="function"}function I(r){return r.validateAsync!==void 0&&r.id!==void 0}function M(r){return r.isJoi===!0}function U(r){return"_parse"in r||"_run"in r||typeof r=="function"&&"schema"in r}function Z(r){return r.parse!==void 0}async function z(r,e){const t=await("_parse"in e?e._parse(r):"_run"in e?e._run({typed:!1,value:r},{}):e(r));return!t.issues||t.issues.length===0?{errors:null,result:"output"in t?t.output:"value"in t?t.value:null}:{errors:t.issues.map(s=>{var n;return{path:((n=s.path)==null?void 0:n.map(l=>l.key).join("."))||"",message:s.message}}),result:null}}async function C(r,e){try{return await e.validateAsync(r,{abortEarly:!1}),{errors:null,result:r}}catch(t){if(M(t))return{errors:t.details.map(s=>({path:s.path.join("."),message:s.message})),result:null};throw t}}async function K(r,e){const t=await e.safeParseAsync(r);return t.success===!1?{errors:t.error.issues.map(s=>({path:s.path.join("."),message:s.message})),result:null}:{result:t.data,errors:null}}async function N(r,e){const[t,u]=e.validate(r);return t?{errors:t.failures().map(n=>({message:n.message,path:n.path.join(".")})),result:null}:{errors:null,result:u}}async function R(r,e){try{return{errors:null,result:e.validateSync(r,{abortEarly:!1})}}catch(t){if(V(t))return{errors:t.inner.map(s=>({path:s.path??"",message:s.message})),result:null};throw t}}function x(r,e){if(Z(e))return K(r,e);if(I(e))return C(r,e);if(U(e))return z(r,e);if(B(e))return R(r,e);if(q(e))return N(r,e);throw new Error("Form validation failed: Unsupported form schema")}function D(r,e,t,u,s,n){return O(),$("form",{onSubmit:e[0]||(e[0]=k((...l)=>r.onSubmit&&r.onSubmit(...l),["prevent"]))},[A(r.$slots,"default",J(F({errors:r.errors})))],32)}const L=b(Y,[["render",D]]);export{L as default};
